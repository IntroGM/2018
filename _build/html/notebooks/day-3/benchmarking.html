

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Testing your code and benchmarking &mdash; Introduction to Geodynamic Modelling 2018 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Introduction to Geodynamic Modelling 2018 documentation" href="../../index.html"/>
        <link rel="next" title="FD for Stokes equation" href="stokes.html"/>
        <link rel="prev" title="Heat diffusion + advection" href="../day-2/diffadv.html"/>
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Introduction to Geodynamic Modelling
          

          
            
            <img src="../../_static/HY-logo-2017.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2018
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/course-info.html">General info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/learning-goals.html">Learning goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/grading.html">Grading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/licensing.html">License and terms of usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/previous-years.html">Past versions of this course</a></li>
</ul>
<p class="caption"><span class="caption-text">Day 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../lessons/day-1/Course-overview.html">Introduction to geodynamic modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lessons/day-1/physical-processes.html">Key physical processes and concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lessons/day-1/solving-equations.html">Solving equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-1/python-basics.html">Basic elements of Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-1/Functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-1/NumPy.html">Introduction to NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-1/for-loops.html">for loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-1/Conditional-statements.html">Conditional statements</a></li>
</ul>
<p class="caption"><span class="caption-text">Day 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day-2/fdbasics.html">Introduction to finite differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-2/fdheat.html">Finite differences for heat equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-2/stability.html">Stability of the heat equation FD approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../day-2/diffadv.html">Heat diffusion + advection</a></li>
</ul>
<p class="caption"><span class="caption-text">Day 3</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing your code and benchmarking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Sources-of-error-(revisited)">Sources of error (revisited)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Calculating-error">Calculating error</a></li>
<li class="toctree-l2"><a class="reference internal" href="#How-do-you-know-when-your-solution-is-“correct”?">How do you know when your solution is “correct”?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Exercise---Spatial-errors-in-heat-conduction">Exercise - Spatial errors in heat conduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Tasks">Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Questions">Questions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Exercise---Visualizing-error-(optional)">Exercise - Visualizing error (optional)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Tasks">Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Questions">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Stability-for-advection-problems">Stability for advection problems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Exercise---The-time-bomb">Exercise - The time bomb</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Questions">Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="stokes.html">FD for Stokes equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Solution strategy for the channel flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html#Calculating-strain-rates">Calculating strain rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html#Velocity-boundary-conditions">Velocity boundary conditions</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical instructions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../instructions/cluster.html">Using geo-hpcc cluster</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Introduction to Geodynamic Modelling</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Testing your code and benchmarking</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/notebooks/day-3/benchmarking.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="admonition note">
This page was generated from <a class="reference external" href="https://github.com/IntroGM/2018/blob/master/source/notebooks/day-3/benchmarking.ipynb">source/notebooks/day-3/benchmarking.ipynb</a>.
Interactive online version:
<span class="raw-html"><a href="https://mybinder.org/v2/gh/IntroGM/2018/master?urlpath=lab/tree/source/notebooks/day-3/benchmarking.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge.svg" style="vertical-align:text-bottom"></a></span></div>
<div class="section" id="Testing-your-code-and-benchmarking">
<h1>Testing your code and benchmarking<a class="headerlink" href="#Testing-your-code-and-benchmarking" title="Permalink to this headline">¶</a></h1>
<p>As we have seen <a class="reference internal" href="../day-2/fdbasics.html"><span class="doc">yesterday</span></a>, it is possible
to use the finite difference method to solve equations, and if we use a
sufficiently high resolution we can get a very precise solution. But is
it correct? It can be difficult to know without directly comparing our
solutions to known correct values. This process will be the focus of
this lesson.</p>
<div class="section" id="Sources-of-error-(revisited)">
<h2>Sources of error (revisited)<a class="headerlink" href="#Sources-of-error-(revisited)" title="Permalink to this headline">¶</a></h2>
<p>We have focussed thus far on using the finite difference method to
approximate solutions to equations that we cannot directly integrate. As
we have seen, the definition of a derivative is</p>
<div class="math notranslate nohighlight">
\[\frac{\mathrm{d}f}{\mathrm{d}x}\rvert_{x=x_0} = \lim_{\Delta x \rightarrow 0} \frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x},\]</div>
<p>which we can approximate in a number of forms by removing the limit
<span class="math notranslate nohighlight">\(\Delta x \rightarrow 0\)</span>. For example, we have seen that for
forward differences we can state</p>
<div class="math notranslate nohighlight">
\[\frac{\mathrm{d}f}{\mathrm{d}x}\rvert_{x=x_0} \approx \frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x}.\]</div>
<p>And again, as long as <span class="math notranslate nohighlight">\(\Delta x\)</span> is “small enough”, the error that
is introduced in this approximation is fairly small. So the question is,
how do we know when <span class="math notranslate nohighlight">\(\Delta x\)</span> is small enough to not introduce
significant error? Before we can answer that question, we need to say a
few things about the sources of error in any computer-based calculation
and how we can calculate these errors.</p>
<p>In computations there are essentially three different sources of error
we can consider:</p>
<ul class="simple">
<li><strong>Gross error</strong>: A mistake in the program itself, a bug.</li>
<li><strong>Truncation error</strong>: Error introduced by approximating the solution
to a problem, such as using a finite-difference solution rather than
direct integration of an equation. You might recall this is the error
we introduce by <a class="reference internal" href="../day-2/fdbasics.html#Taylor-series-approach;-accuracy"><span class="std std-ref">truncating the Taylor series
expansion</span></a>
of a function <span class="math notranslate nohighlight">\(f(x)\)</span>.</li>
<li><strong>Roundoff error</strong>: Error related to the computers inability to
exactly represent floating point numbers. We have seen some examples
of roundoff error as well at the <a class="reference external" href="..day-2/fdbasics.ipynb#Introduction-to-finite-differences">start of the introduction to finite
differences</a>.</li>
</ul>
<p>Although all three of these sources of error can appear in our programs,
we mainly will focus on issues related to truncation error in our
discussion in the following sections.</p>
</div>
<div class="section" id="Calculating-error">
<h2>Calculating error<a class="headerlink" href="#Calculating-error" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a sense of the different types of error we might
encounter, we can turn our focus to how error can be calculated. Simply
put, the <strong>error</strong> in a calculation is simply the difference between the
calculated value and the actual value. In other words,</p>
<div class="math notranslate nohighlight">
\[E = \bar{x} - x\]</div>
<p>where <span class="math notranslate nohighlight">\(E\)</span> is the error in the calculated value <span class="math notranslate nohighlight">\(x\)</span> compared
to its true value <span class="math notranslate nohighlight">\(\bar{x}\)</span>. Another common way in which error is
represented is as <strong>relative error</strong> (<span class="math notranslate nohighlight">\(RE\)</span>), which is simply the
error divided by the true value,</p>
<div class="math notranslate nohighlight">
\[RE = \frac{E}{\bar{x}}\]</div>
<p>For our purposes we will mainly consider the <strong>percent error</strong>
(<span class="math notranslate nohighlight">\(PE\)</span>), which is just the relative error multiplied by 100</p>
<div class="math notranslate nohighlight">
\[PE = 100 RE.\]</div>
</div>
<div class="section" id="How-do-you-know-when-your-solution-is-“correct”?">
<h2>How do you know when your solution is “correct”?<a class="headerlink" href="#How-do-you-know-when-your-solution-is-“correct”?" title="Permalink to this headline">¶</a></h2>
<p>In order to determine whether or not we need to be concerned with errors
in our estimates, we need to compare our estimate to the true values as
seen above. This process is often referred to as <strong>benchmarking</strong> or
<strong>stability testing</strong>. How do we do this in practice? We recommend the
following procedure:</p>
<ol class="arabic simple">
<li>Start with using an approximate solution for which a true value can
be calculated. It is obviously not possible to make a comparison if
you don’t know the true values.</li>
<li>Assuming you have an equation the will allow you to calculate true
values at any location within the domain of your problem, begin by
calculating the estimated values and true values at the same spatial
(and/or temporal) locations.</li>
<li>For each estimate and corresponding true value, calculate the percent
error and store its value.</li>
<li>Review the output in a form that makes sense to you. Possibilities
include<ul>
<li>Calculating the mean percent error, or its maximum</li>
<li>Plotting the percent error along with the estimated values</li>
<li>Summing the percent error</li>
</ul>
</li>
</ol>
<div class="section" id="Exercise---Spatial-errors-in-heat-conduction">
<h3>Exercise - Spatial errors in heat conduction<a class="headerlink" href="#Exercise---Spatial-errors-in-heat-conduction" title="Permalink to this headline">¶</a></h3>
<p>Now that you hopefully have a working solution to the heat
advection-diffusion equation in one dimension we can assess the
magnitude of error we introduce when poorly discretizing the problem in
space. In other words, how bad do things get when we only estimate
temperatures at distant points? For this exercise, you can use either
your existing solution to the 1D heat advection-diffusion equation or
the code in the cell below.</p>
<div class="section" id="Tasks">
<h4>Tasks<a class="headerlink" href="#Tasks" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Add the calculation of two analytical solutions for heat conduction
to the bottom of the code. These will be used for comparison with the
finite difference calculations. The analytical solutions to add are
<strong>(1) steady-state advection with no heat production</strong></p>
<div class="math notranslate nohighlight">
\[T(x) = T_{L} \left( \frac{1 - \exp{(v_{x} x / \kappa)}}{1 - \exp{(v_{x} L / \kappa)}} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(T_{L}\)</span> is the temperature at the bottom of the model,
<span class="math notranslate nohighlight">\(v_{x}\)</span> is the advection velocity, <span class="math notranslate nohighlight">\(L\)</span> is the model
thickness, and <span class="math notranslate nohighlight">\(\kappa\)</span> is the thermal diffusivity
(<span class="math notranslate nohighlight">\(\kappa = k / \rho C_{\mathrm{p}}\)</span>), and <strong>(2) steady-state
heat conduction with heat production, but no advection</strong></p>
<div class="math notranslate nohighlight">
\[T(x) = \frac{x T_{L}}{L} + \frac{h^{2}_{\mathrm{r}} H}{k} \left( \left( 1 - \exp{(-x / h_{\mathrm{r}})}\right) - \left( 1 - \exp{(-L / h_{\mathrm{r}})}\right) \frac{x}{L} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(h_{\mathrm{r}}\)</span> is the depth at which the concentration
of heat producing elements decreases by <span class="math notranslate nohighlight">\(1/e\)</span>. Since we do not
include this behavior in our model, we will assume that
<span class="math notranslate nohighlight">\(h_{\mathrm{r}} = 10000\)</span> km.</p>
</li>
<li><p class="first">Implement the calculation of the analytical solutions (true values)
at the end of the code just above the plotting so that the true
values are calculated at the same spatial locations <span class="math notranslate nohighlight">\(x\)</span> as the
finite difference calculations. You can set things up so that you
calculate <code class="docutils literal notranslate"><span class="pre">Tss_adv</span></code> for the advection case and <code class="docutils literal notranslate"><span class="pre">Tss_hp</span></code> for the
heat production case.</p>
</li>
<li><p class="first">Add the necessary code to be able to plot either one of the
analytical solutions with the finite difference solution.</p>
</li>
<li><p class="first">Since we are comparing against steady-state solutions, we need to be
sure that our model has reached a thermal steady state. We can
estimate the time needed to reach steady state using the
characteristic timescale for diffusion <span class="math notranslate nohighlight">\(\tau\)</span></p>
<div class="math notranslate nohighlight">
\[\tau = \frac{L^{2}}{\kappa}.\]</div>
<p>calculate the characteristic timescale for your models using the
values in the code and be sure to set <code class="docutils literal notranslate"><span class="pre">t_total</span></code> to be larger than
that timescale (perhaps even twice as large to be safe).</p>
</li>
<li><p class="first">Starting with <code class="docutils literal notranslate"><span class="pre">nx</span> <span class="pre">=</span> <span class="pre">6</span></code>), calculate the percent error in the
calculated temperature for each location of <span class="math notranslate nohighlight">\(x\)</span> for the
following scenarios:</p>
<ul class="simple">
<li>Steady advection-diffusion with no heat production (<code class="docutils literal notranslate"><span class="pre">vx</span> <span class="pre">=</span> <span class="pre">1.0</span></code>,
<code class="docutils literal notranslate"><span class="pre">H</span> <span class="pre">=</span> <span class="pre">0.0</span></code>)</li>
<li>Steady heat diffusion and production with no advection
(<code class="docutils literal notranslate"><span class="pre">vx</span> <span class="pre">=</span> <span class="pre">0.0</span></code>, <code class="docutils literal notranslate"><span class="pre">H</span> <span class="pre">=</span> <span class="pre">1.0</span></code>)</li>
</ul>
<p>Remember to change which analytical solution is used when you compare
to the model output.</p>
</li>
<li><p class="first">Add two lines to the code near the end to print out the minimum and
maximum percent error to the screen using the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function.</p>
</li>
</ol>
</div>
<div class="section" id="Questions">
<h4>Questions<a class="headerlink" href="#Questions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>If you vary the values for <code class="docutils literal notranslate"><span class="pre">nx</span></code>, approximately how many points are
required for the percent error to be less than 0.05%?</li>
<li>Does the percent error continue to decrease as you increase <code class="docutils literal notranslate"><span class="pre">nx</span></code>,
or does it a appear to reach a minimum at some point?</li>
</ul>
</div>
<div class="section" id="Notes">
<h4>Notes<a class="headerlink" href="#Notes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Although it is possible to perform step 5 directly in NumPy and
without a for loop, you are advised to use a for loop for calculating
the percent error.</li>
<li>You may want to skip over calculating the percent error for the first
temperature point since the true value at the surface is equal to
zero, and calculating percent error at the location will result in
division by zero.</li>
</ul>
<div class="nbinput container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">yr2sec</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mf">365.25</span>  <span class="c1"># num of seconds in a year</span>

<span class="c1"># Set material properties</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2900</span>   <span class="c1"># kg m^-3</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="mi">900</span>     <span class="c1"># J kg^-1 K^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">2.5</span>      <span class="c1"># W m^-1 K^-1</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">1.0</span>      <span class="c1"># uW m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1"># mm/a</span>
<span class="n">hr</span> <span class="o">=</span> <span class="mi">10000</span>   <span class="c1"># km</span>

<span class="c1"># Set geometry and dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">35e3</span>         <span class="c1"># m</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">6</span>           <span class="c1"># -</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># m</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># NOTE: I have set the sill top and bottom equal to not have an intrusion</span>
<span class="n">silltop</span> <span class="o">=</span> <span class="mf">10e3</span>   <span class="c1"># m</span>
<span class="n">sillbott</span> <span class="o">=</span> <span class="mf">10e3</span>  <span class="c1"># m</span>

<span class="c1"># Convert units</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="mf">1.0e-6</span>                    <span class="c1"># uW m^-3 -&gt; W m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="o">-</span><span class="n">vx</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">yr2sec</span>        <span class="c1"># mm a^-1 -&gt; m s^-1</span>
<span class="n">hr</span> <span class="o">=</span> <span class="n">hr</span> <span class="o">*</span> <span class="mi">1000</span>                    <span class="c1"># km -&gt; m</span>

<span class="c1"># Set total time and time step</span>
<span class="n">t_total</span> <span class="o">=</span> <span class="mf">0.1e6</span> <span class="o">*</span> <span class="n">yr2sec</span>          <span class="c1"># s</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">yr2sec</span>                 <span class="c1"># s</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t_total</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>  <span class="c1"># -</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Calculating&quot;</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="s2">&quot;time steps&quot;</span><span class="p">)</span>

<span class="c1"># Set boundary temperature values and intrusion temperature</span>
<span class="n">Tsurf</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># deg C</span>
<span class="n">Tmoho</span> <span class="o">=</span> <span class="mf">600.0</span>      <span class="c1"># deg C</span>
<span class="n">Tintrusion</span> <span class="o">=</span> <span class="mf">700.0</span> <span class="c1"># deg C</span>

<span class="c1"># Create arrays to hold temperature fields</span>
<span class="n">Tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
<span class="n">Tprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

<span class="c1"># Create coordinates of the grid points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># Generate initial temperature field</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sillbott</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">silltop</span><span class="p">):</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tintrusion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tmoho</span> <span class="o">-</span> <span class="n">Tsurf</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># Plot initial temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tprev</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T initial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Start the loop over time steps</span>
<span class="n">curtime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">curtime</span> <span class="o">&lt;</span> <span class="n">t_total</span><span class="p">:</span>
    <span class="n">curtime</span> <span class="o">=</span> <span class="n">curtime</span> <span class="o">+</span> <span class="n">dt</span>

    <span class="c1"># boundary conditions</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsurf</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tmoho</span>

    <span class="c1"># internal grid points</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Tnew</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">vx</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

    <span class="c1"># copy Tnew to Tprev</span>
    <span class="n">Tprev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Tnew</span><span class="p">[:]</span>

<span class="c1"># Calculate analytical solution(s)</span>
<span class="c1"># 1. Steady-state advection, no heat production</span>
<span class="c1">#Tss_adv =</span>

<span class="c1"># 2. Steady-state conduction with heat production, no advection</span>
<span class="c1">#Tss_hp =</span>

<span class="c1"># Plot the final temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T final&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<div class="highlight"><pre>
dx is 7000.0 m
Calculating 10 time steps
</pre></div></div>
</div>
<div class="nboutput container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../../_images/notebooks_day-3_benchmarking_5_1.png" src="../../_images/notebooks_day-3_benchmarking_5_1.png" />
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../../_images/notebooks_day-3_benchmarking_5_2.png" src="../../_images/notebooks_day-3_benchmarking_5_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Exercise---Visualizing-error-(optional)">
<h3>Exercise - Visualizing error (optional)<a class="headerlink" href="#Exercise---Visualizing-error-(optional)" title="Permalink to this headline">¶</a></h3>
<p>In the previous exercise we observed error by outputting the minimum and
maximum to the screen using the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function. However, it is
often nice to not only see the range of error, but also how it varies in
your calculation. In other words, it is nice to see where the error is
largest, not just how large it may be. In this exercise we will add a
plot to those displayed in the heat conduction script to see both the
temperatures and percent error side by side.</p>
<div class="section" id="Tasks">
<h4>Tasks<a class="headerlink" href="#Tasks" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Taking your code from the previous exercise, you will need to make
some changes to the plotting at the end of the script to be able to
display two plots side by side. You can start by making the changes
below in your code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_ss_adv</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (C)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth (km)&quot;</span><span class="p">)</span>
<span class="c1"># Plot percent error below</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The main changes above are (1) changing the <code class="docutils literal notranslate"><span class="pre">plt.subplots()</span></code>
function to produce 1 row of plots with 2 columns of plots, and
referring to those as <code class="docutils literal notranslate"><span class="pre">ax1</span></code> and <code class="docutils literal notranslate"><span class="pre">ax2</span></code>, (2) replacing the
<code class="docutils literal notranslate"><span class="pre">plt.xlabel()</span></code> and <code class="docutils literal notranslate"><span class="pre">plt.ylabel()</span></code> with their equivalent commands
for each plot, and (3) adding the second plot as <code class="docutils literal notranslate"><span class="pre">ax2</span></code>.</p>
</li>
<li><p class="first">With the changes above, insert the variables you want to plot on the
<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> axes of the second plot in the <code class="docutils literal notranslate"><span class="pre">ax2.plot()</span></code>
function, using the plot format <code class="docutils literal notranslate"><span class="pre">'-*'</span></code>.</p>
</li>
<li><p class="first">Add a label for the <span class="math notranslate nohighlight">\(x\)</span> axis for the second plot.</p>
</li>
</ol>
</div>
<div class="section" id="Questions">
<h4>Questions<a class="headerlink" href="#Questions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>If you perform a similar analysis to that done in the previous
exercise (changing <code class="docutils literal notranslate"><span class="pre">nx</span></code> and viewing the resulting error), does this
seem more helpful than simply looking at the minimum and maximum
error values?</li>
<li>Do you see any changes in terms of where the error occurs, or its
magnitude at different depths when you change <code class="docutils literal notranslate"><span class="pre">nx</span></code>?</li>
</ul>
</div>
</div>
</div>
<div class="section" id="Stability-for-advection-problems">
<h2>Stability for advection problems<a class="headerlink" href="#Stability-for-advection-problems" title="Permalink to this headline">¶</a></h2>
<p>We have observed that changing the spatial resolution (distance between
calculation points) can affect the error in our finite difference
solutions. Specifically, larger distances between points tends to
increase error. We have also been <a class="reference external" href="../stability.ipynb">introduced</a> to
problems with the <strong>stability</strong> of our solutions. As a reminder, the
stability of a solution refers to whether or not a small change in the
parameters of the system results in unstable growth of errors. For
problems involving time, a stable solution should either show a decrease
in error with time or errors that do not change with time. An unstable
solution will show growth of errors with time that do not become
bounded, and often grow larger over time.</p>
<p>Yesterday we dealt mainly with diffusion of thermal energy and
encountered a <em>stability condition for diffusion problems</em></p>
<div class="math notranslate nohighlight">
\[\frac{\kappa \Delta t}{\Delta x^2} \leq \frac{1}{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(\kappa\)</span> is the thermal diffusivity, <span class="math notranslate nohighlight">\(\Delta t\)</span> is the
time step, and <span class="math notranslate nohighlight">\(\Delta x\)</span> is the grid spacing. This condition
ensures that the length scale for diffusion does not exceed the length
scale of the grid spacing and that error does not grow with time. As
mentioned, it is often the case that a more strict stability condition
is used such as
<span class="math notranslate nohighlight">\(\frac{\kappa \Delta t}{\Delta x^2} \leq \frac{1}{4}\)</span>.</p>
<p>Like diffusion problems, advection problems also have various criteria
that can be used to ensure stability of the solution and the range of
parameters that result in stable behavior. For example, it is common to
use the calculation of the Courant-Friedrichs-Lewy (or CFL) condition in
problems that involve advection. The CFL condition states that the
distance material is advected should not exceed the distance between
points in the solution grid. In mathematical terms, the CFL condition is</p>
<div class="math notranslate nohighlight">
\[C = \frac{u \Delta t}{\Delta x} \leq C_{\mathrm{max}}\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span> is the velocity of advection. We expect a stable
solution as long as <span class="math notranslate nohighlight">\(C_{\mathrm{max}} \leq 1.0\)</span>. In fact, like the
case for diffusion many people use a smaller value to ensure stability
with a typical value of <span class="math notranslate nohighlight">\(C_{\mathrm{max}} \leq 0.5\)</span> to ensure a
stable solution.</p>
<div class="section" id="Exercise---The-time-bomb">
<h3>Exercise - The time bomb<a class="headerlink" href="#Exercise---The-time-bomb" title="Permalink to this headline">¶</a></h3>
<p>We’ll now take a look and an example of how a solution might become
unstable. We will again use our advection-diffusion solution, this time
exploring the effect of changes in time step. A copy of the code from
the last exercise is below, minus the plotting of the analytical
solutions.</p>
<div class="section" id="Questions">
<h4>Questions<a class="headerlink" href="#Questions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Using a spatial grid resolution of <code class="docutils literal notranslate"><span class="pre">nx</span> <span class="pre">=</span> <span class="pre">30</span></code>, what do you observe
as you increase the time step increment <code class="docutils literal notranslate"><span class="pre">dt</span></code> from <span class="math notranslate nohighlight">\(10^{4}\)</span>
years? Try increasing in steps of <span class="math notranslate nohighlight">\(1 \times 10^{4}\)</span> until you
notice a change in the calculated temperatures.</li>
<li>Do you observe any surprising changes in the error?</li>
<li>Why do you think this might occur?</li>
<li>Can you relate this to our stability criteria?</li>
</ul>
<div class="nbinput container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">yr2sec</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mf">365.25</span>  <span class="c1"># num of seconds in a year</span>

<span class="c1"># Set material properties</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2900</span>   <span class="c1"># kg m^-3</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="mi">900</span>     <span class="c1"># J kg^-1 K^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">2.5</span>      <span class="c1"># W m^-1 K^-1</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">0.0</span>      <span class="c1"># uW m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="mf">1.0</span>     <span class="c1"># mm/a</span>

<span class="c1"># Set geometry and dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">35e3</span>         <span class="c1"># m</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">30</span>         <span class="c1"># -</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># m</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># NOTE: I have set the sill top and bottom equal to not have an intrusion</span>
<span class="n">silltop</span> <span class="o">=</span> <span class="mf">10e3</span>   <span class="c1"># m</span>
<span class="n">sillbott</span> <span class="o">=</span> <span class="mf">10e3</span>  <span class="c1"># m</span>

<span class="c1"># Convert units</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="mf">1.0e-6</span>                    <span class="c1"># uW m^-3 -&gt; W m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="o">-</span><span class="n">vx</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">yr2sec</span>        <span class="c1"># mm a^-1 -&gt; m s^-1</span>

<span class="c1"># Set total time and time step</span>
<span class="n">t_total</span> <span class="o">=</span> <span class="mf">10.0e6</span> <span class="o">*</span> <span class="n">yr2sec</span>          <span class="c1"># s</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">yr2sec</span>                 <span class="c1"># s</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t_total</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>  <span class="c1"># -</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Calculating&quot;</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="s2">&quot;time steps&quot;</span><span class="p">)</span>

<span class="c1"># Set boundary temperature values and intrusion temperature</span>
<span class="n">Tsurf</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># deg C</span>
<span class="n">Tmoho</span> <span class="o">=</span> <span class="mf">600.0</span>      <span class="c1"># deg C</span>
<span class="n">Tintrusion</span> <span class="o">=</span> <span class="mf">700.0</span> <span class="c1"># deg C</span>

<span class="c1"># Create arrays to hold temperature fields</span>
<span class="n">Tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
<span class="n">Tprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

<span class="c1"># Create coordinates of the grid points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># Generate initial temperature field</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sillbott</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">silltop</span><span class="p">):</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tintrusion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tmoho</span> <span class="o">-</span> <span class="n">Tsurf</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># Plot initial temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tprev</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T initial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Start the loop over time steps</span>
<span class="n">curtime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">curtime</span> <span class="o">&lt;</span> <span class="n">t_total</span><span class="p">:</span>
    <span class="n">curtime</span> <span class="o">=</span> <span class="n">curtime</span> <span class="o">+</span> <span class="n">dt</span>

    <span class="c1"># boundary conditions</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsurf</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tmoho</span>

    <span class="c1"># internal grid points</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Tnew</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">vx</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

    <span class="c1"># copy Tnew to Tprev</span>
    <span class="n">Tprev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Tnew</span><span class="p">[:]</span>

<span class="c1"># Plot the final temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T final&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<div class="highlight"><pre>
dx is 1206.896551724138 m
Calculating 1000 time steps
</pre></div></div>
</div>
<div class="nboutput container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../../_images/notebooks_day-3_benchmarking_9_1.png" src="../../_images/notebooks_day-3_benchmarking_9_1.png" />
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../../_images/notebooks_day-3_benchmarking_9_2.png" src="../../_images/notebooks_day-3_benchmarking_9_2.png" />
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="stokes.html" class="btn btn-neutral float-right" title="FD for Stokes equation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../day-2/diffadv.html" class="btn btn-neutral" title="Heat diffusion + advection" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, L. Kaislaniemi and D. Whipp.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <p><br/><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /></a></p>
     


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2018',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>